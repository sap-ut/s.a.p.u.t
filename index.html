<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.P.U.T. Glass Works Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --sidebar-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
            font-size: 13px;
        }
        
        /* COMPACT SIDEBAR */
        .sidebar-container {
            width: 260px;
            background: white;
            border-right: 1px solid #dee2e6;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 12px 15px;
            background: var(--primary);
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-content {
            padding: 15px;
        }
        
        .form-group-sm {
            margin-bottom: 12px;
        }
        
        .form-group-sm label {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 3px;
            display: block;
        }
        
        .form-control-xs {
            height: 28px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .btn-xs {
            padding: 2px 8px;
            font-size: 11px;
            border-radius: 3px;
            height: 24px;
        }
        
        /* MAIN CONTENT */
        .main-content {
            margin-left: 260px;
            padding: 15px;
            min-height: 100vh;
        }
        
        /* HEADER BAR */
        .header-bar {
            background: white;
            padding: 8px 15px;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .header-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
        }
        
        /* CUSTOMER SECTION - COMPACT */
        .customer-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .customer-box {
            background: white;
            border-radius: 6px;
            padding: 12px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .customer-header {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* PRODUCT TABLE - EXCEL STYLE */
        .table-container {
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .data-table thead {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table th {
            padding: 8px 6px;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.1);
            white-space: nowrap;
        }
        
        .data-table td {
            padding: 4px 6px;
            border: 1px solid #dee2e6;
            text-align: center;
            vertical-align: middle;
        }
        
        .data-table input {
            width: 100%;
            border: 1px solid #ced4da;
            border-radius: 3px;
            padding: 3px 5px;
            font-size: 11px;
            height: 26px;
            text-align: center;
        }
        
        .data-table input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }
        
        /* SIZE INPUT STYLES */
        .size-input-group {
            display: flex;
            gap: 3px;
        }
        
        .size-input-group input {
            flex: 1;
        }
        
        /* TOTAL SECTION */
        .total-section {
            background: white;
            border-radius: 6px;
            padding: 12px;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f1f1f1;
            font-size: 12px;
        }
        
        .total-row:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--danger);
        }
        
        /* DASHBOARD */
        .dashboard-container {
            padding: 15px;
        }
        
        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .module-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .module-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            border-color: var(--secondary);
        }
        
        .module-card i {
            font-size: 24px;
            color: var(--secondary);
            margin-bottom: 8px;
        }
        
        .module-card h6 {
            font-size: 13px;
            font-weight: 600;
            margin: 0;
            color: var(--primary);
        }
        
        /* ATTENDANCE SYSTEM */
        .attendance-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .attendance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        /* REPORTS */
        .reports-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        /* PRINT STYLES */
        @media print {
            .sidebar-container,
            .header-bar .header-actions,
            .no-print {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0;
                padding: 0;
            }
            
            .table-container {
                max-height: none;
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .data-table {
                font-size: 10px;
            }
            
            .data-table th {
                background: #ddd !important;
                color: #000 !important;
                -webkit-print-color-adjust: exact;
            }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar-container {
                width: 100%;
                height: auto;
                position: static;
                margin-bottom: 15px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .customer-section {
                grid-template-columns: 1fr;
            }
            
            .module-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        /* UTILITIES */
        .text-sm { font-size: 11px; }
        .text-xs { font-size: 10px; }
        .fw-600 { font-weight: 600; }
        .cursor-pointer { cursor: pointer; }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar-container">
        <div class="sidebar-header">
            <h6 class="mb-0"><i class="fas fa-industry me-2"></i>S.A.P.U.T.</h6>
        </div>
        
        <div class="sidebar-content">
            <!-- PI SETTINGS -->
            <div class="form-group-sm">
                <label>PI Number</label>
                <input type="text" class="form-control form-control-xs" id="piNumber" value="PI-001" readonly>
            </div>
            
            <div class="form-group-sm">
                <label>Date</label>
                <input type="date" class="form-control form-control-xs" id="piDate">
            </div>
            
            <div class="form-group-sm">
                <label>UOM</label>
                <select class="form-control form-control-xs" id="uom">
                    <option value="sqft">Sq. Ft.</option>
                    <option value="sqmt">Sq. Mt.</option>
                </select>
            </div>
            
            <div class="form-group-sm">
                <label>Wastage</label>
                <select class="form-control form-control-xs" id="wastageMode">
                    <option value="none">No Wastage</option>
                    <option value="round">Round Up</option>
                    <option value="evenin">Even Inches</option>
                </select>
            </div>
            
            <!-- ADD MM -->
            <div class="form-group-sm">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="enableAddMM">
                    <label class="form-check-label text-sm" for="enableAddMM">Add MM</label>
                </div>
            </div>
            
            <div id="mmSettings" style="display: none; margin-top: 10px;">
                <div class="row g-2 mb-2">
                    <div class="col-6">
                        <input type="number" class="form-control form-control-xs" id="addMMWidth" placeholder="Width MM" value="3">
                    </div>
                    <div class="col-6">
                        <input type="number" class="form-control form-control-xs" id="addMMHeight" placeholder="Height MM" value="3">
                    </div>
                </div>
                <button class="btn btn-xs btn-secondary w-100" onclick="applyAddMMToAll()">Apply All</button>
            </div>
            
            <!-- PARTY SELECTION -->
            <div class="form-group-sm">
                <label>Select Party</label>
                <select class="form-control form-control-xs" id="partySelect" onchange="selectParty()">
                    <option value="">Select Party</option>
                </select>
                <button class="btn btn-xs btn-success w-100 mt-1" onclick="addNewParty()">
                    <i class="fas fa-plus fa-xs me-1"></i> New Party
                </button>
            </div>
            
            <!-- QUICK ACTIONS -->
            <div class="form-group-sm">
                <button class="btn btn-xs btn-primary w-100 mb-1" onclick="addNewRow()">
                    <i class="fas fa-plus fa-xs me-1"></i> Add Row
                </button>
                <button class="btn btn-xs btn-warning w-100 mb-1" onclick="calculateAll()">
                    <i class="fas fa-calculator fa-xs me-1"></i> Calculate All
                </button>
                <button class="btn btn-xs btn-danger w-100" onclick="clearAll()">
                    <i class="fas fa-trash fa-xs me-1"></i> Clear All
                </button>
            </div>
            
            <!-- QUICK SUMMARY -->
            <div class="total-section mt-3">
                <div class="total-row">
                    <span>Items:</span>
                    <span id="totalItems">0</span>
                </div>
                <div class="total-row">
                    <span>Area:</span>
                    <span id="totalArea">0 Sq.Ft.</span>
                </div>
                <div class="total-row">
                    <span>Amount:</span>
                    <span id="totalAmount">₹0.00</span>
                </div>
                <div class="total-row">
                    <span>Total:</span>
                    <span id="totalGrand">₹0.00</span>
                </div>
            </div>
            
            <!-- NAVIGATION -->
            <div class="mt-3">
                <button class="btn btn-xs btn-outline-primary w-100 mb-1" onclick="showDashboard()">
                    <i class="fas fa-home fa-xs me-1"></i> Dashboard
                </button>
                <button class="btn btn-xs btn-outline-success w-100 mb-1" onclick="showReports()">
                    <i class="fas fa-chart-bar fa-xs me-1"></i> Reports
                </button>
                <button class="btn btn-xs btn-outline-warning w-100" onclick="showAttendance()">
                    <i class="fas fa-calendar-check fa-xs me-1"></i> Attendance
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content" id="mainContent">
        <!-- DEFAULT: DASHBOARD -->
        <div id="dashboardSection">
            <div class="header-bar">
                <div class="header-title">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <div class="header-actions">
                    <button class="btn btn-sm btn-primary" onclick="showProforma()">
                        <i class="fas fa-plus me-1"></i> New PI
                    </button>
                </div>
            </div>
            
            <div class="module-grid">
                <div class="module-card" onclick="showProforma()">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <h6>Create Proforma</h6>
                </div>
                <div class="module-card" onclick="showQuotation()">
                    <i class="fas fa-file-alt"></i>
                    <h6>Create Quotation</h6>
                </div>
                <div class="module-card" onclick="showReports()">
                    <i class="fas fa-chart-bar"></i>
                    <h6>Reports</h6>
                </div>
                <div class="module-card" onclick="showAttendance()">
                    <i class="fas fa-calendar-check"></i>
                    <h6>Attendance</h6>
                </div>
                <div class="module-card" onclick="showCustomers()">
                    <i class="fas fa-users"></i>
                    <h6>Customers</h6>
                </div>
                <div class="module-card" onclick="showProducts()">
                    <i class="fas fa-box"></i>
                    <h6>Products</h6>
                </div>
                <div class="module-card" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                    <h6>Settings</h6>
                </div>
                <div class="module-card" onclick="showHelp()">
                    <i class="fas fa-question-circle"></i>
                    <h6>Help</h6>
                </div>
            </div>
        </div>

        <!-- PROFORMA SECTION -->
        <div id="proformaSection" style="display: none;">
            <div class="header-bar">
                <div class="header-title">
                    <i class="fas fa-file-invoice-dollar"></i> Proforma Invoice
                </div>
                <div class="header-actions">
                    <button class="btn btn-sm btn-success" onclick="saveProforma()">
                        <i class="fas fa-save me-1"></i> Save
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="printProforma()">
                        <i class="fas fa-print me-1"></i> Print
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="showDashboard()">
                        <i class="fas fa-times me-1"></i> Close
                    </button>
                </div>
            </div>
            
            <!-- CUSTOMER DETAILS -->
            <div class="customer-section">
                <div class="customer-box">
                    <div class="customer-header">
                        <span>BILL TO</span>
                        <i class="fas fa-user-tie text-primary"></i>
                    </div>
                    <div class="mb-2">
                        <input type="text" class="form-control form-control-xs" id="billName" placeholder="Name" value="Raj Glass House">
                    </div>
                    <div class="mb-2">
                        <textarea class="form-control form-control-xs" id="billAddress" rows="1" placeholder="Address">123, Main Market, Delhi</textarea>
                    </div>
                    <div class="row g-2">
                        <div class="col-6">
                            <input type="text" class="form-control form-control-xs" id="billGST" placeholder="GSTIN" value="07AABCU9603R1ZX">
                        </div>
                        <div class="col-6">
                            <input type="text" class="form-control form-control-xs" id="billPhone" placeholder="Phone" value="9876543210">
                        </div>
                    </div>
                </div>
                
                <div class="customer-box">
                    <div class="customer-header">
                        <span>SHIP TO</span>
                        <i class="fas fa-truck text-success"></i>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="sameAsBill" onchange="copyToShip()">
                        <label class="form-check-label text-sm">Same as Bill To</label>
                    </div>
                    <div class="mb-2">
                        <input type="text" class="form-control form-control-xs" id="shipName" placeholder="Name">
                    </div>
                    <div class="mb-2">
                        <textarea class="form-control form-control-xs" id="shipAddress" rows="1" placeholder="Address"></textarea>
                    </div>
                    <div class="row g-2">
                        <div class="col-6">
                            <input type="text" class="form-control form-control-xs" id="shipGST" placeholder="GSTIN">
                        </div>
                        <div class="col-6">
                            <input type="text" class="form-control form-control-xs" id="shipPhone" placeholder="Phone">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PRODUCT TABLE -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="30">#</th>
                            <th width="120">Width (Inches)</th>
                            <th width="120">Height (Inches)</th>
                            <th width="120">Size (MM)</th>
                            <th width="60">Qty</th>
                            <th width="80">Rate</th>
                            <th width="80">Hole</th>
                            <th width="80">Cut</th>
                            <th width="80">Area</th>
                            <th width="100">Amount</th>
                            <th width="40" class="no-print">Del</th>
                        </tr>
                    </thead>
                    <tbody id="productTable">
                        <!-- Rows will be added here -->
                    </tbody>
                </table>
            </div>
            
            <!-- TOTALS -->
            <div class="total-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotalAmount">₹0.00</span>
                </div>
                <div class="total-row">
                    <span>Discount:</span>
                    <span>
                        <input type="number" id="discountPercent" value="0" min="0" max="100" style="width: 40px; padding: 1px;"> %
                        <span id="discountAmount" class="ms-2">₹0.00</span>
                    </span>
                </div>
                <div class="total-row">
                    <span>GST (18%):</span>
                    <span id="gstAmount">₹0.00</span>
                </div>
                <div class="total-row">
                    <span>GRAND TOTAL:</span>
                    <span id="grandTotal">₹0.00</span>
                </div>
            </div>
        </div>

        <!-- REPORTS SECTION -->
        <div id="reportsSection" style="display: none;">
            <div class="header-bar">
                <div class="header-title">
                    <i class="fas fa-chart-bar"></i> Reports
                </div>
                <div class="header-actions">
                    <button class="btn btn-sm btn-primary" onclick="exportReports()">
                        <i class="fas fa-download me-1"></i> Export
                    </button>
                </div>
            </div>
            
            <div class="reports-container">
                <h6 class="mb-3">PI Reports</h6>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>PI No.</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTable">
                            <!-- Reports will load here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ATTENDANCE SECTION -->
        <div id="attendanceSection" style="display: none;">
            <div class="header-bar">
                <div class="header-title">
                    <i class="fas fa-calendar-check"></i> Attendance System
                </div>
                <div class="header-actions">
                    <button class="btn btn-sm btn-primary" onclick="markAttendance()">
                        <i class="fas fa-check me-1"></i> Mark Today
                    </button>
                </div>
            </div>
            
            <div class="attendance-container">
                <div class="attendance-header">
                    <h6 class="mb-0">Employee Attendance</h6>
                    <input type="month" class="form-control form-control-xs" style="width: 150px;" id="attendanceMonth">
                </div>
                
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Emp ID</th>
                                <th>Name</th>
                                <th>Date</th>
                                <th>In Time</th>
                                <th>Out Time</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTable">
                            <!-- Attendance will load here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Party Modal -->
    <div class="modal fade" id="partyModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title mb-0">Add Party</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="form-label text-sm">Name</label>
                        <input type="text" class="form-control form-control-xs" id="modalPartyName">
                    </div>
                    <div class="mb-2">
                        <label class="form-label text-sm">Phone</label>
                        <input type="text" class="form-control form-control-xs" id="modalPartyPhone">
                    </div>
                    <div class="mb-2">
                        <label class="form-label text-sm">Address</label>
                        <textarea class="form-control form-control-xs" id="modalPartyAddress" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <button type="button" class="btn btn-xs btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-xs btn-primary" onclick="saveParty()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header py-2">
                    <h6 class="modal-title mb-0">Settings</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label text-sm">Company Name</label>
                        <input type="text" class="form-control form-control-xs" value="S.A.P.U.T. Glass Works">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-sm">Address</label>
                        <input type="text" class="form-control form-control-xs" value="Karnal, Haryana - 132001">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-sm">Phone</label>
                        <input type="text" class="form-control form-control-xs" value="1111111111">
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-sm">Email</label>
                        <input type="email" class="form-control form-control-xs" value="jperp1001@gmail.com">
                    </div>
                </div>
                <div class="modal-footer py-2">
                    <button type="button" class="btn btn-xs btn-primary" data-bs-dismiss="modal">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Variables
        let currentRow = 1;
        let parties = [];
        let proformas = [];
        let attendance = [];
        
        // Initialize on Load
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('piDate').value = today;
            
            // Generate PI number
            generatePINumber();
            
            // Load data
            loadParties();
            loadProformas();
            loadAttendance();
            
            // Add initial row
            addNewRow();
            
            // Setup event listeners
            setupListeners();
            
            // Show dashboard
            showDashboard();
        }
        
        function setupListeners() {
            // Add MM checkbox
            document.getElementById('enableAddMM').addEventListener('change', function() {
                document.getElementById('mmSettings').style.display = this.checked ? 'block' : 'none';
            });
            
            // Discount input
            document.getElementById('discountPercent').addEventListener('input', calculateSummary);
            
            // Party select
            document.getElementById('partySelect').addEventListener('change', selectParty);
            
            // Same as Bill checkbox
            document.getElementById('sameAsBill').addEventListener('change', copyToShip);
        }
        
        // NAVIGATION
        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardSection').style.display = 'block';
        }
        
        function showProforma() {
            hideAllSections();
            document.getElementById('proformaSection').style.display = 'block';
        }
        
        function showReports() {
            hideAllSections();
            document.getElementById('reportsSection').style.display = 'block';
            loadReportsData();
        }
        
        function showAttendance() {
            hideAllSections();
            document.getElementById('attendanceSection').style.display = 'block';
            loadAttendanceData();
        }
        
        function showQuotation() {
            alert('Quotation module coming soon!');
        }
        
        function showCustomers() {
            alert('Customer management module coming soon!');
        }
        
        function showProducts() {
            alert('Product management module coming soon!');
        }
        
        function showSettings() {
            new bootstrap.Modal(document.getElementById('settingsModal')).show();
        }
        
        function showHelp() {
            alert('Help documentation coming soon!');
        }
        
        function hideAllSections() {
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('proformaSection').style.display = 'none';
            document.getElementById('reportsSection').style.display = 'none';
            document.getElementById('attendanceSection').style.display = 'none';
        }
        
        // PARTY MANAGEMENT
        function loadParties() {
            try {
                parties = JSON.parse(localStorage.getItem('saput_parties')) || [];
            } catch {
                parties = [];
            }
            
            // Default parties
            if (parties.length === 0) {
                parties = [
                    { id: 1, name: 'Raj Glass House', phone: '9876543210', address: '123, Main Market, Delhi', gst: '07AABCU9603R1ZX' },
                    { id: 2, name: 'Shyam Glass Works', phone: '9876543211', address: '456, Industrial Area', gst: '06ABCDE1234F1Z5' },
                    { id: 3, name: 'Modern Glass', phone: '9876543212', address: '789, Sector 5', gst: '' }
                ];
                localStorage.setItem('saput_parties', JSON.stringify(parties));
            }
            
            // Populate party select
            const partySelect = document.getElementById('partySelect');
            partySelect.innerHTML = '<option value="">Select Party</option>';
            parties.forEach(party => {
                const option = document.createElement('option');
                option.value = party.id;
                option.textContent = `${party.name} (${party.phone})`;
                partySelect.appendChild(option);
            });
        }
        
        function selectParty() {
            const partyId = document.getElementById('partySelect').value;
            if (!partyId) return;
            
            const party = parties.find(p => p.id == partyId);
            if (party) {
                document.getElementById('billName').value = party.name;
                document.getElementById('billAddress').value = party.address;
                document.getElementById('billGST').value = party.gst || '';
                document.getElementById('billPhone').value = party.phone;
                
                if (document.getElementById('sameAsBill').checked) {
                    copyToShip();
                }
            }
        }
        
        function addNewParty() {
            document.getElementById('modalPartyName').value = '';
            document.getElementById('modalPartyPhone').value = '';
            document.getElementById('modalPartyAddress').value = '';
            new bootstrap.Modal(document.getElementById('partyModal')).show();
        }
        
        function saveParty() {
            const name = document.getElementById('modalPartyName').value;
            const phone = document.getElementById('modalPartyPhone').value;
            const address = document.getElementById('modalPartyAddress').value;
            
            if (!name || !phone) {
                alert('Name and Phone are required!');
                return;
            }
            
            const newParty = {
                id: parties.length > 0 ? Math.max(...parties.map(p => p.id)) + 1 : 1,
                name: name,
                phone: phone,
                address: address,
                gst: '',
                created: new Date().toISOString()
            };
            
            parties.push(newParty);
            localStorage.setItem('saput_parties', JSON.stringify(parties));
            
            // Update select
            loadParties();
            
            // Select the new party
            document.getElementById('partySelect').value = newParty.id;
            selectParty();
            
            bootstrap.Modal.getInstance(document.getElementById('partyModal')).hide();
        }
        
        function copyToShip() {
            if (document.getElementById('sameAsBill').checked) {
                document.getElementById('shipName').value = document.getElementById('billName').value;
                document.getElementById('shipAddress').value = document.getElementById('billAddress').value;
                document.getElementById('shipGST').value = document.getElementById('billGST').value;
                document.getElementById('shipPhone').value = document.getElementById('billPhone').value;
            }
        }
        
        // PROFORMA FUNCTIONS
        function generatePINumber() {
            const year = new Date().getFullYear();
            const month = (new Date().getMonth() + 1).toString().padStart(2, '0');
            const count = (proformas.length + 1).toString().padStart(3, '0');
            const piNumber = `PI-${year}${month}-${count}`;
            document.getElementById('piNumber').value = piNumber;
            return piNumber;
        }
        
        function addNewRow() {
            const table = document.getElementById('productTable');
            const rowId = currentRow++;
            
            const rowHTML = `
                <tr id="row-${rowId}">
                    <td>${rowId}</td>
                    <td>
                        <div class="size-input-group">
                            <input type="text" class="width-inches" placeholder="16 6/8" value="16 6/8" onchange="calculateRow(${rowId})">
                        </div>
                    </td>
                    <td>
                        <div class="size-input-group">
                            <input type="text" class="height-inches" placeholder="77 5/8" value="77 5/8" onchange="calculateRow(${rowId})">
                        </div>
                    </td>
                    <td>
                        <div class="size-input-group">
                            <input type="number" class="width-mm" placeholder="Width mm" value="1200" onchange="calculateRowFromMM(${rowId})">
                            <input type="number" class="height-mm" placeholder="Height mm" value="2212" onchange="calculateRowFromMM(${rowId})">
                        </div>
                    </td>
                    <td><input type="number" class="qty" value="1" min="1" onchange="calculateRow(${rowId})"></td>
                    <td><input type="number" class="rate" value="450" min="0" onchange="calculateRow(${rowId})"></td>
                    <td><input type="number" class="hole" value="0" min="0" onchange="calculateRow(${rowId})"></td>
                    <td><input type="number" class="cut" value="0" min="0" onchange="calculateRow(${rowId})"></td>
                    <td class="area">0.00</td>
                    <td class="amount">0.00</td>
                    <td class="no-print">
                        <button class="btn btn-xs btn-danger" onclick="deleteRow(${rowId})">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            table.insertAdjacentHTML('beforeend', rowHTML);
            calculateRow(rowId);
        }
        
        function deleteRow(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (row && confirm('Delete this row?')) {
                row.remove();
                calculateAll();
            }
        }
        
        function calculateRow(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (!row) return 0;
            
            // Get inch values (format: "16 6/8")
            const widthInchesText = row.querySelector('.width-inches').value;
            const heightInchesText = row.querySelector('.height-inches').value;
            
            const widthInches = parseInches(widthInchesText);
            const heightInches = parseInches(heightInchesText);
            
            const qty = parseFloat(row.querySelector('.qty').value) || 1;
            const rate = parseFloat(row.querySelector('.rate').value) || 450;
            const hole = parseFloat(row.querySelector('.hole').value) || 0;
            const cut = parseFloat(row.querySelector('.cut').value) || 0;
            
            // Calculate MM values
            const widthMM = Math.round(widthInches * 25.4);
            const heightMM = Math.round(heightInches * 25.4);
            
            // Update MM fields
            row.querySelector('.width-mm').value = widthMM;
            row.querySelector('.height-mm').value = heightMM;
            
            // Add MM if enabled
            if (document.getElementById('enableAddMM').checked) {
                const addWidthMM = parseFloat(document.getElementById('addMMWidth').value) || 0;
                const addHeightMM = parseFloat(document.getElementById('addMMHeight').value) || 0;
                row.querySelector('.width-mm').value = widthMM + addWidthMM;
                row.querySelector('.height-mm').value = heightMM + addHeightMM;
            }
            
            // Calculate area in sq.ft
            const areaSqFt = (widthInches * heightInches) / 144;
            const amount = areaSqFt * rate * qty;
            
            // Update row
            row.querySelector('.area').textContent = areaSqFt.toFixed(2);
            row.querySelector('.amount').textContent = amount.toFixed(2);
            
            // Store data
            row.dataset.amount = amount;
            row.dataset.area = areaSqFt;
            
            // Update summary
            calculateSummary();
            
            return amount;
        }
        
        function calculateRowFromMM(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (!row) return;
            
            const widthMM = parseFloat(row.querySelector('.width-mm').value) || 0;
            const heightMM = parseFloat(row.querySelector('.height-mm').value) || 0;
            
            // Convert MM to inches
            const widthInches = widthMM / 25.4;
            const heightInches = heightMM / 25.4;
            
            // Convert to feet-inches-fraction format
            const widthFormatted = formatInches(widthInches);
            const heightFormatted = formatInches(heightInches);
            
            // Update inch fields
            row.querySelector('.width-inches').value = widthFormatted;
            row.querySelector('.height-inches').value = heightFormatted;
            
            // Recalculate
            calculateRow(rowId);
        }
        
        function parseInches(text) {
            if (!text) return 0;
            
            // Format: "16 6/8" or "16.75" or "16"
            text = text.trim();
            
            // Check for fraction format
            if (text.includes(' ')) {
                const parts = text.split(' ');
                const whole = parseFloat(parts[0]) || 0;
                const fraction = parts[1] || '0';
                
                if (fraction.includes('/')) {
                    const [num, den] = fraction.split('/');
                    return whole + (parseFloat(num) / parseFloat(den));
                }
                return whole + parseFloat(fraction);
            }
            
            // Decimal format
            return parseFloat(text) || 0;
        }
        
        function formatInches(inches) {
            const feet = Math.floor(inches / 12);
            const remainingInches = inches % 12;
            const wholeInches = Math.floor(remainingInches);
            const fractionInches = remainingInches - wholeInches;
            
            // Convert fraction to nearest 1/8
            const fractions = [0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875];
            let closestFraction = 0;
            let minDiff = 1;
            
            fractions.forEach(frac => {
                const diff = Math.abs(fractionInches - frac);
                if (diff < minDiff) {
                    minDiff = diff;
                    closestFraction = frac;
                }
            });
            
            if (closestFraction === 0) {
                return `${feet} ${wholeInches}`;
            }
            
            const fractionText = getFractionText(closestFraction);
            return `${feet} ${wholeInches} ${fractionText}`;
        }
        
        function getFractionText(fraction) {
            const fractions = {
                0.125: '1/8',
                0.25: '1/4',
                0.375: '3/8',
                0.5: '1/2',
                0.625: '5/8',
                0.75: '3/4',
                0.875: '7/8'
            };
            return fractions[fraction] || '';
        }
        
        function applyAddMMToAll() {
            document.querySelectorAll('#productTable tr').forEach((row, index) => {
                if (row.id && row.id.startsWith('row-')) {
                    calculateRow(parseInt(row.id.replace('row-', '')));
                }
            });
        }
        
        function calculateAll() {
            let totalAmount = 0;
            let totalArea = 0;
            let totalItems = 0;
            
            document.querySelectorAll('#productTable tr').forEach(row => {
                if (row.id && row.id.startsWith('row-')) {
                    const rowId = parseInt(row.id.replace('row-', ''));
                    const amount = calculateRow(rowId);
                    totalAmount += amount || 0;
                    totalArea += parseFloat(row.dataset.area) || 0;
                    totalItems += parseFloat(row.querySelector('.qty').value) || 0;
                }
            });
            
            // Update quick summary
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalArea').textContent = totalArea.toFixed(2) + ' Sq.Ft.';
            document.getElementById('totalAmount').textContent = '₹' + totalAmount.toFixed(2);
            
            calculateSummary();
        }
        
        function calculateSummary() {
            let subtotal = 0;
            
            document.querySelectorAll('#productTable tr').forEach(row => {
                if (row.id && row.id.startsWith('row-')) {
                    subtotal += parseFloat(row.dataset.amount) || 0;
                }
            });
            
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            const discountAmount = subtotal * (discountPercent / 100);
            const afterDiscount = subtotal - discountAmount;
            const gstAmount = afterDiscount * 0.18;
            const grandTotal = afterDiscount + gstAmount;
            
            // Update invoice summary
            document.getElementById('subtotalAmount').textContent = '₹' + subtotal.toFixed(2);
            document.getElementById('discountAmount').textContent = '₹' + discountAmount.toFixed(2);
            document.getElementById('gstAmount').textContent = '₹' + gstAmount.toFixed(2);
            document.getElementById('grandTotal').textContent = '₹' + grandTotal.toFixed(2);
            
            // Update quick summary total
            document.getElementById('totalGrand').textContent = '₹' + grandTotal.toFixed(2);
        }
        
        function clearAll() {
            if (confirm('Clear all items?')) {
                document.getElementById('productTable').innerHTML = '';
                currentRow = 1;
                addNewRow();
                calculateSummary();
            }
        }
        
        // SAVE PROFORMA
        function saveProforma() {
            const proforma = {
                id: document.getElementById('piNumber').value,
                date: document.getElementById('piDate').value,
                customer: {
                    billTo: {
                        name: document.getElementById('billName').value,
                        address: document.getElementById('billAddress').value,
                        gst: document.getElementById('billGST').value,
                        phone: document.getElementById('billPhone').value
                    },
                    shipTo: {
                        name: document.getElementById('shipName').value,
                        address: document.getElementById('shipAddress').value,
                        gst: document.getElementById('shipGST').value,
                        phone: document.getElementById('shipPhone').value
                    }
                },
                items: [],
                totals: {},
                created: new Date().toISOString(),
                status: 'draft'
            };
            
            // Collect items
            document.querySelectorAll('#productTable tr').forEach(row => {
                if (row.id && row.id.startsWith('row-')) {
                    const item = {
                        widthInches: row.querySelector('.width-inches').value,
                        heightInches: row.querySelector('.height-inches').value,
                        widthMM: row.querySelector('.width-mm').value,
                        heightMM: row.querySelector('.height-mm').value,
                        qty: row.querySelector('.qty').value,
                        rate: row.querySelector('.rate').value,
                        hole: row.querySelector('.hole').value,
                        cut: row.querySelector('.cut').value,
                        area: row.querySelector('.area').textContent,
                        amount: row.querySelector('.amount').textContent
                    };
                    proforma.items.push(item);
                }
            });
            
            // Add totals
            proforma.totals = {
                items: parseInt(document.getElementById('totalItems').textContent) || 0,
                area: document.getElementById('totalArea').textContent,
                subtotal: document.getElementById('subtotalAmount').textContent.replace('₹', ''),
                discount: document.getElementById('discountAmount').textContent.replace('₹', ''),
                gst: document.getElementById('gstAmount').textContent.replace('₹', ''),
                grandTotal: document.getElementById('grandTotal').textContent.replace('₹', '')
            };
            
            // Save to localStorage
            try {
                proformas = JSON.parse(localStorage.getItem('saput_proformas')) || [];
                proformas.push(proforma);
                localStorage.setItem('saput_proformas', JSON.stringify(proformas));
                
                alert('Proforma saved successfully!');
                generatePINumber();
                clearAll();
            } catch (e) {
                alert('Error saving proforma');
            }
        }
        
        function loadProformas() {
            try {
                proformas = JSON.parse(localStorage.getItem('saput_proformas')) || [];
            } catch {
                proformas = [];
            }
        }
        
        // PRINT FUNCTION
        function printProforma() {
            window.print();
        }
        
        // REPORTS
        function loadReportsData() {
            loadProformas();
            
            const table = document.getElementById('reportsTable');
            table.innerHTML = '';
            
            proformas.slice(-20).reverse().forEach(pi => {
                const totalItems = pi.items?.length || 0;
                const totalAmount = pi.totals?.grandTotal || 0;
                const status = pi.status || 'draft';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${pi.id}</td>
                    <td>${new Date(pi.date).toLocaleDateString('en-IN')}</td>
                    <td>${pi.customer?.billTo?.name || 'N/A'}</td>
                    <td>₹${parseFloat(totalAmount).toFixed(2)}</td>
                    <td><span class="badge bg-${status === 'paid' ? 'success' : 'warning'}">${status}</span></td>
                    <td>
                        <button class="btn btn-xs btn-primary" onclick="viewPI('${pi.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        function viewPI(piId) {
            const pi = proformas.find(p => p.id === piId);
            if (pi) {
                // Fill the form
                document.getElementById('piNumber').value = pi.id;
                document.getElementById('piDate').value = pi.date;
                
                if (pi.customer?.billTo) {
                    document.getElementById('billName').value = pi.customer.billTo.name;
                    document.getElementById('billAddress').value = pi.customer.billTo.address;
                    document.getElementById('billGST').value = pi.customer.billTo.gst;
                    document.getElementById('billPhone').value = pi.customer.billTo.phone;
                }
                
                if (pi.customer?.shipTo) {
                    document.getElementById('shipName').value = pi.customer.shipTo.name;
                    document.getElementById('shipAddress').value = pi.customer.shipTo.address;
                    document.getElementById('shipGST').value = pi.customer.shipTo.gst;
                    document.getElementById('shipPhone').value = pi.customer.shipTo.phone;
                }
                
                // Clear and add items
                document.getElementById('productTable').innerHTML = '';
                currentRow = 1;
                
                pi.items?.forEach(item => {
                    addNewRow();
                    const row = document.getElementById(`row-${currentRow - 1}`);
                    if (row) {
                        row.querySelector('.width-inches').value = item.widthInches;
                        row.querySelector('.height-inches').value = item.heightInches;
                        row.querySelector('.width-mm').value = item.widthMM;
                        row.querySelector('.height-mm').value = item.heightMM;
                        row.querySelector('.qty').value = item.qty;
                        row.querySelector('.rate').value = item.rate;
                        row.querySelector('.hole').value = item.hole;
                        row.querySelector('.cut').value = item.cut;
                        calculateRow(currentRow - 1);
                    }
                });
                
                showProforma();
            }
        }
        
        function exportReports() {
            alert('Export feature coming soon!');
        }
        
        // ATTENDANCE SYSTEM
        function loadAttendance() {
            try {
                attendance = JSON.parse(localStorage.getItem('saput_attendance')) || [];
            } catch {
                attendance = [];
            }
        }
        
        function loadAttendanceData() {
            const table = document.getElementById('attendanceTable');
            table.innerHTML = '';
            
            // Sample attendance data
            const sampleData = [
                { id: 1, name: 'Ramesh Kumar', date: '2023-12-01', inTime: '09:00', outTime: '18:00', status: 'Present' },
                { id: 2, name: 'Suresh Singh', date: '2023-12-01', inTime: '09:15', outTime: '18:30', status: 'Present' },
                { id: 3, name: 'Mahesh Yadav', date: '2023-12-01', inTime: '09:30', outTime: '17:45', status: 'Present' },
                { id: 4, name: 'Rajesh Sharma', date: '2023-12-01', inTime: '', outTime: '', status: 'Absent' }
            ];
            
            sampleData.forEach(emp => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>EMP${emp.id.toString().padStart(3, '0')}</td>
                    <td>${emp.name}</td>
                    <td>${emp.date}</td>
                    <td>${emp.inTime}</td>
                    <td>${emp.outTime}</td>
                    <td><span class="badge bg-${emp.status === 'Present' ? 'success' : 'danger'}">${emp.status}</span></td>
                    <td>
                        <button class="btn btn-xs btn-warning">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        function markAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const time = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            
            // Add attendance record
            attendance.push({
                empId: 'EMP001',
                name: 'Current User',
                date: today,
                inTime: time,
                outTime: '',
                status: 'Present'
            });
            
            localStorage.setItem('saput_attendance', JSON.stringify(attendance));
            alert('Attendance marked for today at ' + time);
            loadAttendanceData();
        }
        
        // Initialize app
        initApp();
    </script>
</body>
</html>
