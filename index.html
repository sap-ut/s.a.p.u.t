<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.P.U.T. Glass Works - Complete ERP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- TOP NAVIGATION BAR WITH LOGO -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow">
        <div class="container-fluid">
            <!-- LOGO -->
            <a class="navbar-brand" href="#" onclick="showDashboard()">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="fas fa-glass-whiskey"></i>
                    </div>
                    <div class="logo-text">
                        <span class="logo-main">S.A.P.U.T.</span>
                        <span class="logo-sub">Glass Works</span>
                    </div>
                </div>
            </a>
            
            <!-- NAVIGATION MENU -->
            <div class="navbar-nav flex-row gap-2">
                <button class="btn btn-sm btn-light" onclick="showDashboard()">
                    <i class="fas fa-home"></i> Dashboard
                </button>
                <button class="btn btn-sm btn-light" onclick="showProforma()">
                    <i class="fas fa-file-invoice-dollar"></i> Proforma
                </button>
                <button class="btn btn-sm btn-light" onclick="showOrderManagement()">
                    <i class="fas fa-clipboard-list"></i> Orders
                </button>
                <button class="btn btn-sm btn-light" onclick="showCustomerManagement()">
                    <i class="fas fa-users"></i> Customers
                </button>
                <button class="btn btn-sm btn-light" onclick="showItemMaster()">
                    <i class="fas fa-box"></i> Items
                </button>
                <button class="btn btn-sm btn-light" onclick="showReports()">
                    <i class="fas fa-chart-bar"></i> Reports
                </button>
                <button class="btn btn-sm btn-light" onclick="showGSTInvoice()">
                    <i class="fas fa-file-invoice"></i> GST
                </button>
            </div>
            
            <!-- USER INFO -->
            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-light text-dark" id="currentModule">Dashboard</span>
                <button class="btn btn-sm btn-outline-light" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <div class="container-fluid" style="margin-top: 70px;">
        
        <!-- DASHBOARD SECTION -->
        <div id="dashboardSection">
            <div class="row">
                <!-- QUICK STATS -->
                <div class="col-md-3 mb-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h6><i class="fas fa-file-invoice-dollar"></i> Today's Proforma</h6>
                            <h3 id="todayProformaCount">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h6><i class="fas fa-clipboard-check"></i> Active Orders</h6>
                            <h3 id="activeOrdersCount">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <h6><i class="fas fa-rupee-sign"></i> Today's Revenue</h6>
                            <h3 id="todayRevenue">₹0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h6><i class="fas fa-users"></i> Total Customers</h6>
                            <h3 id="totalCustomers">0</h3>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- DASHBOARD GRID WITH SMALL ICONS -->
            <div class="dashboard-grid">
                <!-- Row 1 -->
                <div class="module-card" onclick="showProforma()">
                    <div class="module-icon bg-primary">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="module-info">
                        <h6>Proforma Invoice</h6>
                        <small>Create PI with all features</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showOrderManagement()">
                    <div class="module-icon bg-success">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="module-info">
                        <h6>Order Management</h6>
                        <small>Create & track orders</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showCustomerManagement()">
                    <div class="module-icon bg-info">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="module-info">
                        <h6>Customers</h6>
                        <small>Manage customers</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showItemMaster()">
                    <div class="module-icon bg-warning">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="module-info">
                        <h6>Item Master</h6>
                        <small>Manage products</small>
                    </div>
                </div>
                
                <!-- Row 2 -->
                <div class="module-card" onclick="showAccounting()">
                    <div class="module-icon bg-secondary">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="module-info">
                        <h6>Accounting</h6>
                        <small>Accounts & ledger</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showGSTInvoice()">
                    <div class="module-icon bg-danger">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="module-info">
                        <h6>GST Invoice</h6>
                        <small>Create GST invoices</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showReports()">
                    <div class="module-icon bg-dark">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="module-info">
                        <h6>Reports</h6>
                        <small>View all reports</small>
                    </div>
                </div>
                
                <div class="module-card" onclick="showSettings()">
                    <div class="module-icon bg-purple">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="module-info">
                        <h6>Settings</h6>
                        <small>System settings</small>
                    </div>
                </div>
            </div>
            
            <!-- RECENT ACTIVITIES -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6><i class="fas fa-history"></i> Recent Activities</h6>
                </div>
                <div class="card-body">
                    <div class="list-group" id="recentActivities">
                        <!-- Activities loaded via JS -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROFORMA INVOICE SECTION -->
        <div id="proformaSection" style="display: none;">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5><i class="fas fa-file-invoice-dollar me-2"></i>Proforma Invoice</h5>
                    <div class="text-muted">
                        <small>Shortcuts: Ins=Add Row | F9=Calculate | Del=Delete Row</small>
                    </div>
                </div>
                <div class="card-body">
                    <!-- CUSTOMER SELECTION -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Customer</label>
                            <div class="input-group">
                                <select class="form-select" id="customerSelect" onchange="loadCustomerDetails()">
                                    <option value="">Select Customer</option>
                                </select>
                                <button class="btn btn-outline-primary" type="button" onclick="showAddCustomerModal()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">PI Number</label>
                            <input type="text" class="form-control" id="piNumber" value="PI-<?php echo date('Ymd-His'); ?>">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="piDate" value="<?php echo date('Y-m-d'); ?>">
                        </div>
                    </div>
                    
                    <!-- CUSTOMER DETAILS -->
                    <div class="row mb-3" id="customerDetails" style="display: none;">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6>Bill To:</h6>
                                    <p id="billToDetails"></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6>Ship To:</h6>
                                    <p id="shipToDetails"></p>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="sameAsBill" onchange="copyBillToShip()">
                                        <label class="form-check-label">Same as Bill To</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GLASS TYPE SELECTOR -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <label class="form-label">Glass Type:</label>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('C')">
                                    <span class="badge bg-primary">C</span> Clear
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('T')">
                                    <span class="badge bg-success">T</span> Toughened
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('L')">
                                    <span class="badge bg-warning">L</span> Laminated
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('P')">
                                    <span class="badge bg-info">P</span> Patterned
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('F')">
                                    <span class="badge bg-secondary">F</span> Frosted
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="setGlassType('DG')">
                                    <span class="badge bg-danger">DG</span> Double Glazed
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PRODUCT TABLE -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th width="30">Sr</th>
                                    <th width="80">Type</th>
                                    <th width="150">Item Description</th>
                                    <th colspan="2">Actual Size (Inches)</th>
                                    <th colspan="2">Actual Size (MM)</th>
                                    <th colspan="2">Chargable Size (MM)</th>
                                    <th width="80">Qty</th>
                                    <th width="100">Area (Sq.Mt.)</th>
                                    <th width="100">Rate (₹/Sq.Mt.)</th>
                                    <th width="120">Amount (₹)</th>
                                    <th width="150">Remark</th>
                                    <th width="40">Del</th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th width="80">W</th>
                                    <th width="80">H</th>
                                    <th width="80">W</th>
                                    <th width="80">H</th>
                                    <th width="80">W</th>
                                    <th width="80">H</th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                                <!-- 50 rows generated by JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ADD ROW BUTTON -->
                    <div class="text-center mt-2">
                        <button class="btn btn-primary btn-sm" onclick="addNewRow()">
                            <i class="fas fa-plus"></i> Add Row (Ins)
                        </button>
                        <button class="btn btn-success btn-sm" onclick="calculateAll()">
                            <i class="fas fa-calculator"></i> Calculate All (F9)
                        </button>
                    </div>
                    
                    <!-- TOTALS SECTION - COMPACT -->
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header py-2">
                                    <h6 class="mb-0">Summary</h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>Total Area:</span>
                                        <span id="totalArea">0 Sq.Mt.</span>
                                    </div>
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>Total Quantity:</span>
                                        <span id="totalQty">0</span>
                                    </div>
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>Basic Amount:</span>
                                        <span id="basicAmount">₹0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header py-2">
                                    <h6 class="mb-0">Tax & Total</h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>GST (18%):</span>
                                        <span id="gstAmount">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between border-bottom py-1">
                                        <span>Round Off:</span>
                                        <span id="roundOff">₹0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between py-1 fw-bold text-danger">
                                        <span>GRAND TOTAL:</span>
                                        <span id="grandTotal">₹0.00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ACTION BUTTONS -->
                    <div class="d-flex justify-content-between mt-3">
                        <div>
                            <button class="btn btn-primary" onclick="saveProforma()">
                                <i class="fas fa-save"></i> Save
                            </button>
                            <button class="btn btn-success" onclick="printProforma()">
                                <i class="fas fa-print"></i> Print
                            </button>
                            <button class="btn btn-info" onclick="generatePDF()">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-warning" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i> Excel
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-secondary" onclick="showDashboard()">
                                <i class="fas fa-home"></i> Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ORDER MANAGEMENT SECTION -->
        <div id="orderManagementSection" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-clipboard-list me-2"></i>Order Management</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Order No</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable">
                                <!-- Orders loaded by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- OTHER SECTIONS SIMILARLY... -->
        
    </div>

    <!-- MODALS -->
    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="mb-3">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="custName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">GST Number</label>
                            <input type="text" class="form-control" id="custGST">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="custAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="custPhone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="custEmail">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script src="database.js"></script>
    
    <script>
        // Set today's date in proforma
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('piDate').valueAsDate = new Date();
            showDashboard();
        });
    </script>
</body>
</html>