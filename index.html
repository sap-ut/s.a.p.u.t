<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.P.U.T. Glass Works - Complete Proforma System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #50C9C3;
            --success-color: #66BB6A;
            --warning-color: #FFA726;
            --danger-color: #EF5350;
            --sidebar-width: 320px;
            --topbar-height: 70px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* DASHBOARD SECTION */
        .dashboard-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #357ABD 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.2);
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .dashboard-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 2px solid transparent;
        }
        
        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }
        
        .dashboard-card i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .dashboard-card h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .dashboard-card p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* MAIN APPLICATION */
        .app-container {
            display: none;
            min-height: 100vh;
        }
        
        /* TOP NAVBAR */
        .top-navbar {
            background: white;
            height: var(--topbar-height);
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navbar-actions {
            display: flex;
            gap: 10px;
            margin-left: auto;
            align-items: center;
        }
        
        .badge-pi {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* MAIN CONTENT LAYOUT */
        .main-content {
            display: flex;
            min-height: calc(100vh - var(--topbar-height));
        }
        
        /* LEFT SIDEBAR - COMPACT */
        .left-sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid #e9ecef;
            padding: 20px;
            overflow-y: auto;
            position: sticky;
            top: var(--topbar-height);
            height: calc(100vh - var(--topbar-height));
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        
        .sidebar-section {
            margin-bottom: 25px;
        }
        
        .sidebar-section h6 {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-control-sm {
            font-size: 0.85rem;
            padding: 8px 12px;
            height: 38px;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .form-control-sm:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .form-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        /* PARTY LIST */
        .party-list {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 5px;
        }
        
        .party-item {
            padding: 10px 12px;
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .party-item:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }
        
        .party-item.active {
            background: #e8f4fd;
            border-color: var(--primary-color);
        }
        
        .party-item .name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }
        
        .party-item .details {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        /* RIGHT CONTENT AREA */
        .right-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        /* CUSTOMER DETAILS CARD */
        .customer-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid transparent;
        }
        
        .customer-card.bill-to {
            border-color: var(--primary-color);
        }
        
        .customer-card.ship-to {
            border-color: var(--secondary-color);
        }
        
        .customer-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .customer-card-header h5 {
            font-size: 1rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .customer-card-header i {
            font-size: 1.2rem;
        }
        
        /* PRODUCT TABLE */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        
        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h5 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-action {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #357ABD;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        /* COMPACT TABLE */
        .compact-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .compact-table thead {
            background: #f8f9fa;
        }
        
        .compact-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }
        
        .compact-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }
        
        .compact-table input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.85rem;
            text-align: center;
            transition: all 0.3s;
        }
        
        .compact-table input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .size-input-group {
            display: flex;
            gap: 4px;
        }
        
        .size-input-group input {
            text-align: center;
        }
        
        .fraction-select {
            width: 70px;
            padding: 6px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        /* SUMMARY SECTION */
        .summary-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .summary-header h5 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.95rem;
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-row.total {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--danger-color);
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
        }
        
        /* REPORTS PAGE */
        .reports-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid;
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-card h3 {
            font-size: 1.8rem;
            margin: 10px 0 5px;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        /* MODAL STYLES */
        .modal-xl {
            max-width: 90%;
        }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-sidebar {
                width: 100%;
                height: auto;
                position: static;
            }
            
            .right-content {
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* UTILITY CLASSES */
        .text-primary { color: var(--primary-color) !important; }
        .text-success { color: var(--success-color) !important; }
        .text-warning { color: var(--warning-color) !important; }
        .text-danger { color: var(--danger-color) !important; }
        
        .bg-primary { background: var(--primary-color) !important; }
        .bg-success { background: var(--success-color) !important; }
        .bg-warning { background: var(--warning-color) !important; }
        .bg-danger { background: var(--danger-color) !important; }
    </style>
</head>
<body>
    <!-- DASHBOARD SECTION -->
    <div class="dashboard-container" id="dashboard">
        <div class="dashboard-header fade-in">
            <h1>S.A.P.U.T. Glass Works Proforma System</h1>
            <p>Complete Glass Processing & Billing Solution</p>
            <div class="contact-info text-white mt-3">
                <p class="mb-1">
                    <i class="fas fa-map-marker-alt me-2"></i>Karnal, Haryana - 132001 |
                    <i class="fas fa-mobile-alt ms-3 me-2"></i>1111111111 |
                    <i class="fas fa-envelope ms-3 me-2"></i>jperp1001@gmail.com
                </p>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card fade-in" onclick="showProforma()">
                <i class="fas fa-file-invoice-dollar"></i>
                <h3>Create Proforma</h3>
                <p>Create professional proforma invoices with advanced calculations</p>
            </div>
            
            <div class="dashboard-card fade-in" onclick="showQuotation()">
                <i class="fas fa-file-alt"></i>
                <h3>Create Quotation</h3>
                <p>Generate detailed quotations with terms & conditions</p>
            </div>
            
            <div class="dashboard-card fade-in" onclick="showReports()">
                <i class="fas fa-chart-bar"></i>
                <h3>View Reports</h3>
                <p>Analyze sales, profits, and business reports</p>
            </div>
            
            <div class="dashboard-card fade-in" onclick="manageParties()">
                <i class="fas fa-users"></i>
                <h3>Manage Parties</h3>
                <p>Add, edit, and manage customer information</p>
            </div>
            
            <div class="dashboard-card fade-in" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <h3>System Settings</h3>
                <p>Configure system preferences and defaults</p>
            </div>
            
            <div class="dashboard-card fade-in" onclick="showHelp()">
                <i class="fas fa-question-circle"></i>
                <h3>Help & Support</h3>
                <p>Get help and documentation for using the system</p>
            </div>
        </div>
    </div>

    <!-- MAIN PROFORMA APPLICATION -->
    <div class="app-container" id="app">
        <!-- TOP NAVBAR -->
        <nav class="top-navbar">
            <div class="navbar-brand">
                <i class="fas fa-industry"></i>
                <span>S.A.P.U.T. Glass Works</span>
                <span class="badge-pi" id="currentProforma">PI-001</span>
            </div>
            
            <div class="navbar-actions">
                <button class="btn btn-sm btn-outline-primary" onclick="showDashboard()">
                    <i class="fas fa-home me-1"></i> Dashboard
                </button>
                <button class="btn btn-sm btn-outline-success" onclick="showReports()">
                    <i class="fas fa-chart-bar me-1"></i> Reports
                </button>
                <button class="btn btn-sm btn-outline-warning" onclick="showSettings()">
                    <i class="fas fa-cog me-1"></i> Settings
                </button>
                <div class="dropdown">
                    <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fas fa-user me-1"></i> User
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user-cog me-2"></i> Profile</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- LEFT SIDEBAR -->
            <div class="left-sidebar">
                <!-- PROFORMA SETTINGS -->
                <div class="sidebar-section">
                    <h6>Proforma Settings</h6>
                    <div class="mb-3">
                        <label class="form-label">Proforma No.</label>
                        <input type="text" class="form-control form-control-sm" id="proformaNo" value="PI-001" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control form-control-sm" id="proformaDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">UOM</label>
                        <select class="form-select form-select-sm" id="uom" onchange="calculateAllRows()">
                            <option value="sqft">Square Feet</option>
                            <option value="sqmt">Square Meters</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Wastage Mode</label>
                        <select class="form-select form-select-sm" id="wastageMode" onchange="toggleWastage()">
                            <option value="none">No Wastage</option>
                            <option value="round">Round Up</option>
                            <option value="evenin">Even Inches</option>
                            <option value="evencm">Even Centimeters</option>
                        </select>
                    </div>
                </div>

                <!-- ADD MM SETTINGS -->
                <div class="sidebar-section">
                    <h6>Add MM Settings</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="enableAddMM" onchange="toggleAddMM()">
                        <label class="form-check-label" for="enableAddMM">
                            Enable Add MM
                        </label>
                    </div>
                    
                    <div id="mmSettings" style="display: none;">
                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <label class="form-label">Width (+MM)</label>
                                <input type="number" class="form-control form-control-sm" id="addMMWidth" value="3" min="0">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Height (+MM)</label>
                                <input type="number" class="form-control form-control-sm" id="addMMHeight" value="3" min="0">
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary w-100" onclick="applyAddMMToAll()">
                            <i class="fas fa-sync fa-xs me-1"></i> Apply to All
                        </button>
                    </div>
                </div>

                <!-- PARTY SELECTION -->
                <div class="sidebar-section">
                    <h6>Select Party</h6>
                    <div class="mb-3">
                        <input type="text" class="form-control form-control-sm" id="searchParty" placeholder="Search party..." onkeyup="searchParties()">
                    </div>
                    <div class="party-list" id="partyList">
                        <!-- Parties will be loaded here -->
                    </div>
                    <button class="btn btn-sm btn-success w-100 mt-2" onclick="showPartyModal()">
                        <i class="fas fa-plus me-1"></i> Add New Party
                    </button>
                </div>

                <!-- QUICK SUMMARY -->
                <div class="sidebar-section">
                    <h6>Quick Summary</h6>
                    <div class="summary-container">
                        <div class="summary-row">
                            <span>Total Items:</span>
                            <span id="summaryItems">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Area:</span>
                            <span id="summaryArea">0 Sq.Ft.</span>
                        </div>
                        <div class="summary-row">
                            <span>Basic Amount:</span>
                            <span id="summaryBasic">₹ 0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>GST (18%):</span>
                            <span id="summaryGST">₹ 0.00</span>
                        </div>
                        <div class="summary-row total">
                            <span>Grand Total:</span>
                            <span id="summaryGrand">₹ 0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT CONTENT AREA -->
            <div class="right-content">
                <!-- CUSTOMER DETAILS -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="customer-card bill-to">
                            <div class="customer-card-header">
                                <h5><i class="fas fa-user-tie me-2"></i>Bill To</h5>
                                <i class="fas fa-building text-primary"></i>
                            </div>
                            <div class="row g-2">
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" id="billName" placeholder="Party Name" value="Raj Glass House">
                                </div>
                                <div class="col-12">
                                    <textarea class="form-control form-control-sm" id="billAddress" rows="2" placeholder="Address">123, Main Market, Delhi</textarea>
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" id="billGST" placeholder="GSTIN" value="07AABCU9603R1ZX">
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" id="billPhone" placeholder="Phone" value="9876543210">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="customer-card ship-to">
                            <div class="customer-card-header">
                                <h5><i class="fas fa-truck me-2"></i>Ship To</h5>
                                <i class="fas fa-shipping-fast text-secondary"></i>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="sameAsBill" onchange="copyToShip()">
                                <label class="form-check-label" for="sameAsBill">
                                    Same as Bill To
                                </label>
                            </div>
                            <div class="row g-2">
                                <div class="col-12">
                                    <input type="text" class="form-control form-control-sm" id="shipName" placeholder="Ship To Name">
                                </div>
                                <div class="col-12">
                                    <textarea class="form-control form-control-sm" id="shipAddress" rows="2" placeholder="Shipping Address"></textarea>
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" id="shipGST" placeholder="GSTIN">
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control form-control-sm" id="shipPhone" placeholder="Phone">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PRODUCT TABLE -->
                <div class="table-container">
                    <div class="table-header">
                        <h5><i class="fas fa-glass-whiskey me-2"></i>Glass Items</h5>
                        <div class="table-actions">
                            <button class="btn-action btn-primary" onclick="addNewRow()">
                                <i class="fas fa-plus me-1"></i> Add Row
                            </button>
                            <button class="btn-action btn-success" onclick="calculateAllRows()">
                                <i class="fas fa-calculator me-1"></i> Calculate All
                            </button>
                            <button class="btn-action btn-warning" onclick="clearAllRows()">
                                <i class="fas fa-trash me-1"></i> Clear All
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="compact-table">
                            <thead>
                                <tr>
                                    <th width="3%">#</th>
                                    <th width="10%">Width (Ft-In-Frac)</th>
                                    <th width="10%">Height (Ft-In-Frac)</th>
                                    <th width="12%">Size in MM</th>
                                    <th width="8%">Qty</th>
                                    <th width="10%">Rate (₹/sq.ft)</th>
                                    <th width="12%">Hole/Cut Qty</th>
                                    <th width="8%">Area</th>
                                    <th width="10%">Amount</th>
                                    <th width="5%">Action</th>
                                </tr>
                            </thead>
                            <tbody id="productTable">
                                <!-- Rows will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- SUMMARY & ACTIONS -->
                <div class="row mt-4">
                    <div class="col-md-8">
                        <div class="summary-container">
                            <div class="summary-header">
                                <h5>Invoice Summary</h5>
                            </div>
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="invoiceSubtotal">₹ 0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Discount:</span>
                                <span>
                                    <input type="number" id="discountPercent" value="0" min="0" max="100" style="width: 60px; padding: 2px;"> %
                                    <span id="discountAmount" class="ms-2">₹ 0.00</span>
                                </span>
                            </div>
                            <div class="summary-row">
                                <span>GST (18%):</span>
                                <span id="invoiceGST">₹ 0.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>GRAND TOTAL:</span>
                                <span id="invoiceGrandTotal">₹ 0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="summary-container">
                            <div class="summary-header">
                                <h5>Actions</h5>
                            </div>
                            <div class="d-grid gap-2">
                                <button class="btn-action btn-primary" onclick="saveProforma()">
                                    <i class="fas fa-save me-2"></i> Save Proforma
                                </button>
                                <button class="btn-action btn-success" onclick="printProforma()">
                                    <i class="fas fa-print me-2"></i> Print/PDF
                                </button>
                                <button class="btn-action btn-warning" onclick="newProforma()">
                                    <i class="fas fa-file me-2"></i> New Proforma
                                </button>
                                <button class="btn-action btn-danger" onclick="emailProforma()">
                                    <i class="fas fa-envelope me-2"></i> Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- REPORTS SECTION -->
    <div class="reports-container" id="reportsSection" style="display: none;">
        <div class="dashboard-header">
            <h1>Reports & Analytics</h1>
            <p>Complete business intelligence and reporting dashboard</p>
        </div>
        
        <div class="stats-grid" id="reportsStats">
            <!-- Stats will be loaded here -->
        </div>
        
        <div class="chart-container">
            <h5 class="mb-3">Revenue Trend</h5>
            <canvas id="revenueChart"></canvas>
        </div>
        
        <div class="table-container mt-4">
            <div class="table-header">
                <h5><i class="fas fa-file-invoice me-2"></i>Recent Proformas</h5>
                <div class="table-actions">
                    <button class="btn-action btn-primary" onclick="exportReports()">
                        <i class="fas fa-download me-1"></i> Export Excel
                    </button>
                    <button class="btn-action btn-success" onclick="printReports()">
                        <i class="fas fa-print me-1"></i> Print
                    </button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="compact-table" id="reportsTable">
                    <!-- Reports will be loaded here -->
                </table>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Party Modal -->
    <div class="modal fade" id="partyModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add/Edit Party</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Party Name *</label>
                            <input type="text" class="form-control" id="modalPartyName">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Contact Person</label>
                            <input type="text" class="form-control" id="modalContactPerson">
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="modalAddress" rows="2"></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Phone *</label>
                            <input type="text" class="form-control" id="modalPhone">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="modalEmail">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">GSTIN</label>
                            <input type="text" class="form-control" id="modalGST">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">PAN</label>
                            <input type="text" class="form-control" id="modalPAN">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveParty()">Save Party</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">System Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Company Settings</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Company Name</label>
                                        <input type="text" class="form-control" value="S.A.P.U.T. Glass Works">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <textarea class="form-control" rows="2">Karnal, Haryana - 132001</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone</label>
                                        <input type="text" class="form-control" value="1111111111">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" value="jperp1001@gmail.com">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Default Rates</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Clear Glass 6mm (₹/sq.ft)</label>
                                        <input type="number" class="form-control" value="450">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Toughened Glass (₹/sq.ft)</label>
                                        <input type="number" class="form-control" value="650">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Laminated Glass (₹/sq.ft)</label>
                                        <input type="number" class="form-control" value="850">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">GST Percentage</label>
                                        <input type="number" class="form-control" value="18">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Other Settings</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Default UOM</label>
                                        <select class="form-select">
                                            <option value="sqft">Square Feet</option>
                                            <option value="sqmt">Square Meters</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Default Wastage</label>
                                        <select class="form-select">
                                            <option value="none">No Wastage</option>
                                            <option value="round">Round Up</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Auto Numbering</label>
                                        <select class="form-select">
                                            <option value="auto">Auto Generate</option>
                                            <option value="manual">Manual Entry</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Print Format</label>
                                        <select class="form-select">
                                            <option value="a4">A4 Size</option>
                                            <option value="thermal">Thermal</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Help & Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6>Quick Guide</h6>
                    <ol>
                        <li>Select party from sidebar or add new</li>
                        <li>Enter glass sizes in feet, inches, fractions</li>
                        <li>Add +MM if needed for cutting wastage</li>
                        <li>Enter quantity and rate per sq.ft</li>
                        <li>Click Calculate All to compute totals</li>
                        <li>Save or Print the proforma</li>
                    </ol>
                    <hr>
                    <h6>Support</h6>
                    <p>Email: jperp1001@gmail.com</p>
                    <p>Phone: 1111111111</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script>
        // Global Variables
        let currentProformaId = 1;
        let rowCounter = 1;
        let parties = [];
        let proformas = [];
        
        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        function initializeApp() {
            // Set current date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('proformaDate').value = today;
            
            // Load saved data
            loadParties();
            loadProformas();
            
            // Generate proforma number
            generateProformaNumber();
            
            // Add initial row
            addNewRow();
            
            // Setup event listeners
            setupEventListeners();
        }
        
        function setupEventListeners() {
            // Discount percentage change
            document.getElementById('discountPercent').addEventListener('input', calculateSummary);
            
            // Date picker
            flatpickr("#proformaDate", {
                dateFormat: "Y-m-d",
                defaultDate: "today"
            });
        }
        
        // NAVIGATION FUNCTIONS
        function showDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('app').style.display = 'none';
            document.getElementById('reportsSection').style.display = 'none';
        }
        
        function showProforma() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('reportsSection').style.display = 'none';
        }
        
        function showQuotation() {
            alert('Quotation module coming soon!');
        }
        
        function showReports() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('app').style.display = 'none';
            document.getElementById('reportsSection').style.display = 'block';
            loadReportsData();
        }
        
        function manageParties() {
            showPartyModal();
        }
        
        function showSettings() {
            new bootstrap.Modal(document.getElementById('settingsModal')).show();
        }
        
        function showHelp() {
            new bootstrap.Modal(document.getElementById('helpModal')).show();
        }
        
        // PARTY MANAGEMENT
        function loadParties() {
            // Load from localStorage or use defaults
            try {
                parties = JSON.parse(localStorage.getItem('saput_parties')) || [];
            } catch {
                parties = [];
            }
            
            // Default parties if none exist
            if (parties.length === 0) {
                parties = [
                    {
                        id: 1,
                        name: 'Raj Glass House',
                        address: '123, Main Market, Delhi',
                        gst: '07AABCU9603R1ZX',
                        phone: '9876543210',
                        email: 'raj@glass.com'
                    },
                    {
                        id: 2,
                        name: 'Shyam Glass Works',
                        address: '456, Industrial Area, Noida',
                        gst: '09AAECS1234N1Z6',
                        phone: '9876543211',
                        email: 'shyam@glass.com'
                    },
                    {
                        id: 3,
                        name: 'Modern Glass Solutions',
                        address: '789, Sector 5, Panipat',
                        gst: '',
                        phone: '9876543212',
                        email: 'modern@glass.com'
                    }
                ];
                localStorage.setItem('saput_parties', JSON.stringify(parties));
            }
            
            renderPartyList();
        }
        
        function renderPartyList() {
            const partyList = document.getElementById('partyList');
            partyList.innerHTML = '';
            
            parties.forEach(party => {
                const partyItem = document.createElement('div');
                partyItem.className = 'party-item';
                partyItem.innerHTML = `
                    <div class="name">${party.name}</div>
                    <div class="details">${party.phone} | ${party.address.substring(0, 30)}...</div>
                `;
                partyItem.onclick = () => selectParty(party);
                partyList.appendChild(partyItem);
            });
        }
        
        function selectParty(party) {
            document.getElementById('billName').value = party.name;
            document.getElementById('billAddress').value = party.address;
            document.getElementById('billGST').value = party.gst;
            document.getElementById('billPhone').value = party.phone;
            
            // Highlight selected party
            document.querySelectorAll('.party-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.party-item').classList.add('active');
            
            // Copy to ship if checkbox is checked
            if (document.getElementById('sameAsBill').checked) {
                copyToShip();
            }
        }
        
        function searchParties() {
            const searchTerm = document.getElementById('searchParty').value.toLowerCase();
            const partyItems = document.querySelectorAll('.party-item');
            
            partyItems.forEach(item => {
                const name = item.querySelector('.name').textContent.toLowerCase();
                const details = item.querySelector('.details').textContent.toLowerCase();
                if (name.includes(searchTerm) || details.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function showPartyModal() {
            // Clear modal fields
            document.getElementById('modalPartyName').value = '';
            document.getElementById('modalContactPerson').value = '';
            document.getElementById('modalAddress').value = '';
            document.getElementById('modalPhone').value = '';
            document.getElementById('modalEmail').value = '';
            document.getElementById('modalGST').value = '';
            document.getElementById('modalPAN').value = '';
            
            new bootstrap.Modal(document.getElementById('partyModal')).show();
        }
        
        function saveParty() {
            const party = {
                id: parties.length > 0 ? Math.max(...parties.map(p => p.id)) + 1 : 1,
                name: document.getElementById('modalPartyName').value,
                contactPerson: document.getElementById('modalContactPerson').value,
                address: document.getElementById('modalAddress').value,
                phone: document.getElementById('modalPhone').value,
                email: document.getElementById('modalEmail').value,
                gst: document.getElementById('modalGST').value,
                pan: document.getElementById('modalPAN').value,
                created: new Date().toISOString()
            };
            
            if (!party.name || !party.phone) {
                alert('Party name and phone are required!');
                return;
            }
            
            parties.push(party);
            localStorage.setItem('saput_parties', JSON.stringify(parties));
            
            renderPartyList();
            bootstrap.Modal.getInstance(document.getElementById('partyModal')).hide();
            
            // Select the new party
            selectParty(party);
            
            alert('Party saved successfully!');
        }
        
        function copyToShip() {
            if (document.getElementById('sameAsBill').checked) {
                document.getElementById('shipName').value = document.getElementById('billName').value;
                document.getElementById('shipAddress').value = document.getElementById('billAddress').value;
                document.getElementById('shipGST').value = document.getElementById('billGST').value;
                document.getElementById('shipPhone').value = document.getElementById('billPhone').value;
            }
        }
        
        // PROFORMA FUNCTIONS
        function generateProformaNumber() {
            const year = new Date().getFullYear();
            const month = (new Date().getMonth() + 1).toString().padStart(2, '0');
            const count = (proformas.length + 1).toString().padStart(3, '0');
            const piNumber = `PI-${year}${month}-${count}`;
            
            document.getElementById('proformaNo').value = piNumber;
            document.getElementById('currentProforma').textContent = piNumber;
            
            return piNumber;
        }
        
        function addNewRow() {
            const table = document.getElementById('productTable');
            const rowId = rowCounter++;
            
            const rowHTML = `
                <tr id="row-${rowId}" data-id="${rowId}">
                    <td>${rowId}</td>
                    <td>
                        <div class="size-input-group">
                            <input type="number" class="width-feet" placeholder="Ft" value="4" min="0" onchange="calculateRow(${rowId})">
                            <input type="number" class="width-inch" placeholder="In" value="0" min="0" max="11" onchange="calculateRow(${rowId})">
                            <select class="fraction-select width-frac" onchange="calculateRow(${rowId})">
                                <option value="0">0"</option>
                                <option value="0.125">1/8"</option>
                                <option value="0.25">1/4"</option>
                                <option value="0.375">3/8"</option>
                                <option value="0.5" selected>1/2"</option>
                                <option value="0.625">5/8"</option>
                                <option value="0.75">3/4"</option>
                                <option value="0.875">7/8"</option>
                            </select>
                        </div>
                    </td>
                    <td>
                        <div class="size-input-group">
                            <input type="number" class="height-feet" placeholder="Ft" value="3" min="0" onchange="calculateRow(${rowId})">
                            <input type="number" class="height-inch" placeholder="In" value="0" min="0" max="11" onchange="calculateRow(${rowId})">
                            <select class="fraction-select height-frac" onchange="calculateRow(${rowId})">
                                <option value="0">0"</option>
                                <option value="0.125">1/8"</option>
                                <option value="0.25" selected>1/4"</option>
                                <option value="0.375">3/8"</option>
                                <option value="0.5">1/2"</option>
                                <option value="0.625">5/8"</option>
                                <option value="0.75">3/4"</option>
                                <option value="0.875">7/8"</option>
                            </select>
                        </div>
                    </td>
                    <td>
                        <div class="size-input-group">
                            <input type="number" class="mm-width" placeholder="W mm" readonly style="background: #f8f9fa;">
                            <input type="number" class="mm-height" placeholder="H mm" readonly style="background: #f8f9fa;">
                        </div>
                    </td>
                    <td><input type="number" class="qty" value="1" min="1" onchange="calculateRow(${rowId})"></td>
                    <td><input type="number" class="rate" value="450" min="0" step="0.01" onchange="calculateRow(${rowId})"></td>
                    <td>
                        <div class="size-input-group">
                            <input type="number" class="hole-qty" placeholder="Holes" value="0" min="0" onchange="calculateRow(${rowId})">
                            <input type="number" class="cut-qty" placeholder="Cuts" value="0" min="0" onchange="calculateRow(${rowId})">
                        </div>
                    </td>
                    <td class="area-cell">0.00</td>
                    <td class="amount-cell">0.00</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeRow(${rowId})">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                </tr>
            `;
            
            table.insertAdjacentHTML('beforeend', rowHTML);
            
            // Calculate the new row
            calculateRow(rowId);
        }
        
        function calculateRow(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (!row) return;
            
            // Get inch values
            const widthFeet = parseFloat(row.querySelector('.width-feet').value) || 0;
            const widthInch = parseFloat(row.querySelector('.width-inch').value) || 0;
            const widthFrac = parseFloat(row.querySelector('.width-frac').value) || 0;
            
            const heightFeet = parseFloat(row.querySelector('.height-feet').value) || 0;
            const heightInch = parseFloat(row.querySelector('.height-inch').value) || 0;
            const heightFrac = parseFloat(row.querySelector('.height-frac').value) || 0;
            
            const qty = parseFloat(row.querySelector('.qty').value) || 1;
            const rate = parseFloat(row.querySelector('.rate').value) || 450;
            const holeQty = parseFloat(row.querySelector('.hole-qty').value) || 0;
            const cutQty = parseFloat(row.querySelector('.cut-qty').value) || 0;
            
            // Calculate total inches
            const totalWidthInches = (widthFeet * 12) + widthInch + widthFrac;
            const totalHeightInches = (heightFeet * 12) + heightInch + heightFrac;
            
            // Add MM if enabled
            let addMMWidth = 0, addMMHeight = 0;
            if (document.getElementById('enableAddMM').checked) {
                addMMWidth = parseFloat(document.getElementById('addMMWidth').value) || 0;
                addMMHeight = parseFloat(document.getElementById('addMMHeight').value) || 0;
            }
            
            // Calculate MM values
            const widthMM = Math.round((totalWidthInches * 25.4) + addMMWidth);
            const heightMM = Math.round((totalHeightInches * 25.4) + addMMHeight);
            
            // Calculate area
            const areaSqFt = (totalWidthInches * totalHeightInches) / 144;
            const amount = areaSqFt * rate * qty;
            
            // Update row
            row.querySelector('.mm-width').value = widthMM;
            row.querySelector('.mm-height').value = heightMM;
            row.querySelector('.area-cell').textContent = areaSqFt.toFixed(2);
            row.querySelector('.amount-cell').textContent = amount.toFixed(2);
            
            // Store amount in data attribute
            row.dataset.amount = amount;
            row.dataset.area = areaSqFt;
            
            // Update summary
            calculateSummary();
            
            return amount;
        }
        
        function calculateAllRows() {
            let totalAmount = 0;
            let totalArea = 0;
            let totalItems = 0;
            
            document.querySelectorAll('#productTable tr').forEach(row => {
                const rowId = row.dataset.id;
                if (rowId) {
                    const amount = calculateRow(parseInt(rowId));
                    totalAmount += amount || 0;
                    totalArea += parseFloat(row.dataset.area) || 0;
                    totalItems += parseFloat(row.querySelector('.qty').value) || 0;
                }
            });
            
            updateSummary(totalItems, totalArea, totalAmount);
        }
        
        function removeRow(rowId) {
            const row = document.getElementById(`row-${rowId}`);
            if (row && confirm('Delete this item?')) {
                row.remove();
                calculateSummary();
            }
        }
        
        function clearAllRows() {
            if (confirm('Clear all items?')) {
                document.getElementById('productTable').innerHTML = '';
                rowCounter = 1;
                addNewRow();
                calculateSummary();
            }
        }
        
        // ADD MM FUNCTIONS
        function toggleAddMM() {
            const mmSettings = document.getElementById('mmSettings');
            if (document.getElementById('enableAddMM').checked) {
                mmSettings.style.display = 'block';
            } else {
                mmSettings.style.display = 'none';
            }
            calculateAllRows();
        }
        
        function applyAddMMToAll() {
            calculateAllRows();
        }
        
        // SUMMARY CALCULATION
        function calculateSummary() {
            let totalItems = 0;
            let totalArea = 0;
            let totalAmount = 0;
            
            document.querySelectorAll('#productTable tr').forEach(row => {
                const qty = parseFloat(row.querySelector('.qty')?.value) || 0;
                const amount = parseFloat(row.dataset.amount) || 0;
                const area = parseFloat(row.dataset.area) || 0;
                
                totalItems += qty;
                totalArea += area;
                totalAmount += amount;
            });
            
            updateSummary(totalItems, totalArea, totalAmount);
        }
        
        function updateSummary(items, area, basicAmount) {
            // Calculate discount
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            const discountAmount = basicAmount * (discountPercent / 100);
            const afterDiscount = basicAmount - discountAmount;
            
            // Calculate GST
            const gstPercent = 18; // Can be changed in settings
            const gstAmount = afterDiscount * (gstPercent / 100);
            const grandTotal = afterDiscount + gstAmount;
            
            // Update quick summary
            document.getElementById('summaryItems').textContent = items;
            document.getElementById('summaryArea').textContent = area.toFixed(2) + ' Sq.Ft.';
            document.getElementById('summaryBasic').textContent = '₹ ' + basicAmount.toFixed(2);
            document.getElementById('summaryGST').textContent = '₹ ' + gstAmount.toFixed(2);
            document.getElementById('summaryGrand').textContent = '₹ ' + grandTotal.toFixed(2);
            
            // Update invoice summary
            document.getElementById('invoiceSubtotal').textContent = '₹ ' + basicAmount.toFixed(2);
            document.getElementById('discountAmount').textContent = '₹ ' + discountAmount.toFixed(2);
            document.getElementById('invoiceGST').textContent = '₹ ' + gstAmount.toFixed(2);
            document.getElementById('invoiceGrandTotal').textContent = '₹ ' + grandTotal.toFixed(2);
        }
        
        // SAVE PROFORMA
        function saveProforma() {
            const proforma = {
                id: document.getElementById('proformaNo').value,
                date: document.getElementById('proformaDate').value,
                customer: {
                    billTo: {
                        name: document.getElementById('billName').value,
                        address: document.getElementById('billAddress').value,
                        gst: document.getElementById('billGST').value,
                        phone: document.getElementById('billPhone').value
                    },
                    shipTo: {
                        name: document.getElementById('shipName').value,
                        address: document.getElementById('shipAddress').value,
                        gst: document.getElementById('shipGST').value,
                        phone: document.getElementById('shipPhone').value
                    }
                },
                items: [],
                summary: {},
                created: new Date().toISOString(),
                status: 'draft'
            };
            
            // Collect items
            document.querySelectorAll('#productTable tr').forEach(row => {
                if (row.dataset.id) {
                    const item = {
                        widthFeet: row.querySelector('.width-feet').value,
                        widthInch: row.querySelector('.width-inch').value,
                        widthFrac: row.querySelector('.width-frac').value,
                        heightFeet: row.querySelector('.height-feet').value,
                        heightInch: row.querySelector('.height-inch').value,
                        heightFrac: row.querySelector('.height-frac').value,
                        mmWidth: row.querySelector('.mm-width').value,
                        mmHeight: row.querySelector('.mm-height').value,
                        qty: row.querySelector('.qty').value,
                        rate: row.querySelector('.rate').value,
                        holeQty: row.querySelector('.hole-qty').value,
                        cutQty: row.querySelector('.cut-qty').value,
                        area: row.querySelector('.area-cell').textContent,
                        amount: row.querySelector('.amount-cell').textContent
                    };
                    proforma.items.push(item);
                }
            });
            
            // Add summary
            proforma.summary = {
                items: parseInt(document.getElementById('summaryItems').textContent) || 0,
                area: document.getElementById('summaryArea').textContent,
                basicAmount: parseFloat(document.getElementById('summaryBasic').textContent.replace('₹ ', '')) || 0,
                gstAmount: parseFloat(document.getElementById('summaryGST').textContent.replace('₹ ', '')) || 0,
                grandTotal: parseFloat(document.getElementById('summaryGrand').textContent.replace('₹ ', '')) || 0
            };
            
            // Save to localStorage
            try {
                proformas = JSON.parse(localStorage.getItem('saput_proformas')) || [];
                proformas.push(proforma);
                localStorage.setItem('saput_proformas', JSON.stringify(proformas));
                
                alert('Proforma saved successfully!');
                generateProformaNumber();
                clearAllRows();
            } catch (e) {
                alert('Error saving proforma: ' + e.message);
            }
        }
        
        // LOAD PROFORMAS
        function loadProformas() {
            try {
                proformas = JSON.parse(localStorage.getItem('saput_proformas')) || [];
            } catch {
                proformas = [];
            }
        }
        
        // REPORTS FUNCTIONS
        function loadReportsData() {
            loadProformas();
            
            // Calculate stats
            const totalPIs = proformas.length;
            const totalRevenue = proformas.reduce((sum, p) => sum + (p.summary?.grandTotal || 0), 0);
            const pendingAmount = proformas.filter(p => p.status === 'pending')
                .reduce((sum, p) => sum + (p.summary?.grandTotal || 0), 0);
            const avgOrderValue = totalPIs > 0 ? totalRevenue / totalPIs : 0;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const pisThisMonth = proformas.filter(p => {
                const piDate = new Date(p.date);
                return piDate.getMonth() === currentMonth && piDate.getFullYear() === currentYear;
            }).length;
            
            // Update stats
            document.getElementById('reportsStats').innerHTML = `
                <div class="stat-card" style="border-color: var(--primary-color);">
                    <i class="fas fa-file-invoice" style="color: var(--primary-color);"></i>
                    <h3>${totalPIs}</h3>
                    <p class="mb-0">Total PIs</p>
                </div>
                <div class="stat-card" style="border-color: var(--success-color);">
                    <i class="fas fa-rupee-sign" style="color: var(--success-color);"></i>
                    <h3>₹${(totalRevenue / 1000).toFixed(1)}K</h3>
                    <p class="mb-0">Total Revenue</p>
                </div>
                <div class="stat-card" style="border-color: var(--warning-color);">
                    <i class="fas fa-clock" style="color: var(--warning-color);"></i>
                    <h3>₹${(pendingAmount / 1000).toFixed(1)}K</h3>
                    <p class="mb-0">Pending Amount</p>
                </div>
                <div class="stat-card" style="border-color: var(--secondary-color);">
                    <i class="fas fa-chart-line" style="color: var(--secondary-color);"></i>
                    <h3>₹${avgOrderValue.toFixed(0)}</h3>
                    <p class="mb-0">Avg Order Value</p>
                </div>
            `;
            
            // Update table
            updateReportsTable();
        }
        
        function updateReportsTable() {
            const table = document.getElementById('reportsTable');
            if (!table) return;
            
            let html = `
                <thead>
                    <tr>
                        <th>PI No.</th>
                        <th>Date</th>
                        <th>Customer</th>
                        <th>Items</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            proformas.slice(-10).reverse().forEach(pi => {
                const totalItems = pi.items?.reduce((sum, item) => sum + parseInt(item.qty || 0), 0) || 0;
                const status = pi.status || 'draft';
                const statusClass = status === 'paid' ? 'badge bg-success' : 
                                  status === 'pending' ? 'badge bg-warning' : 'badge bg-secondary';
                
                html += `
                    <tr>
                        <td>${pi.id}</td>
                        <td>${new Date(pi.date).toLocaleDateString('en-IN')}</td>
                        <td>${pi.customer?.billTo?.name || 'N/A'}</td>
                        <td>${totalItems}</td>
                        <td>₹${(pi.summary?.grandTotal || 0).toFixed(2)}</td>
                        <td><span class="${statusClass}">${status.toUpperCase()}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewPI('${pi.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody>';
            table.innerHTML = html;
        }
        
        function viewPI(piId) {
            const pi = proformas.find(p => p.id === piId);
            if (pi) {
                // Fill form with PI data
                document.getElementById('proformaNo').value = pi.id;
                document.getElementById('proformaDate').value = pi.date;
                
                if (pi.customer?.billTo) {
                    document.getElementById('billName').value = pi.customer.billTo.name || '';
                    document.getElementById('billAddress').value = pi.customer.billTo.address || '';
                    document.getElementById('billGST').value = pi.customer.billTo.gst || '';
                    document.getElementById('billPhone').value = pi.customer.billTo.phone || '';
                }
                
                if (pi.customer?.shipTo) {
                    document.getElementById('shipName').value = pi.customer.shipTo.name || '';
                    document.getElementById('shipAddress').value = pi.customer.shipTo.address || '';
                    document.getElementById('shipGST').value = pi.customer.shipTo.gst || '';
                    document.getElementById('shipPhone').value = pi.customer.shipTo.phone || '';
                }
                
                // Clear current items and add PI items
                document.getElementById('productTable').innerHTML = '';
                rowCounter = 1;
                
                pi.items?.forEach(item => {
                    addNewRow();
                    const row = document.getElementById(`row-${rowCounter - 1}`);
                    if (row) {
                        row.querySelector('.width-feet').value = item.widthFeet || 0;
                        row.querySelector('.width-inch').value = item.widthInch || 0;
                        row.querySelector('.width-frac').value = item.widthFrac || 0;
                        row.querySelector('.height-feet').value = item.heightFeet || 0;
                        row.querySelector('.height-inch').value = item.heightInch || 0;
                        row.querySelector('.height-frac').value = item.heightFrac || 0;
                        row.querySelector('.qty').value = item.qty || 1;
                        row.querySelector('.rate').value = item.rate || 450;
                        row.querySelector('.hole-qty').value = item.holeQty || 0;
                        row.querySelector('.cut-qty').value = item.cutQty || 0;
                        calculateRow(rowCounter - 1);
                    }
                });
                
                // Switch to proforma view
                showProforma();
            }
        }
        
        function exportReports() {
            // Create Excel workbook
            const wb = XLSX.utils.book_new();
            
            // Create data array
            const data = proformas.map(pi => ({
                'PI No.': pi.id,
                'Date': pi.date,
                'Customer': pi.customer?.billTo?.name || '',
                'Items': pi.items?.length || 0,
                'Area': pi.summary?.area || '0 Sq.Ft.',
                'Amount': pi.summary?.grandTotal || 0,
                'Status': pi.status || 'draft',
                'Phone': pi.customer?.billTo?.phone || ''
            }));
            
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, "Proforma Reports");
            
            // Save file
            const date = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `SAPUT_Reports_${date}.xlsx`);
        }
        
        function printReports() {
            window.print();
        }
        
        function printProforma() {
            // Simple print function - can be enhanced with proper formatting
            window.print();
        }
        
        function newProforma() {
            if (confirm('Create new proforma? Current data will be lost.')) {
                generateProformaNumber();
                clearAllRows();
                document.getElementById('proformaDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('discountPercent').value = 0;
                
                // Clear customer if needed
                // document.getElementById('billName').value = '';
                // document.getElementById('billAddress').value = '';
                // document.getElementById('billGST').value = '';
                // document.getElementById('billPhone').value = '';
            }
        }
        
        function emailProforma() {
            alert('Email functionality coming soon!');
        }
        
        // Initialize dashboard as default
        showDashboard();
    </script>
</body>
</html>
